# 项目文档

## 作业中对项目的要求

通过完成一个完整的、可部署的全栈应用项目，将前端开发、后端开发、数据库设计、Docker容器化技术及大语言模型（LLM）API调用等关键技术进行综合实践。学生将体验从设计、编码、集成到最终部署的完整软件开发生命周期。 

提交个人项目的github地址（公开可访问），仓库中包括： 

\- 完整的项目源代码（前端、后端、数据库初始化脚本等）。 

\- Dockerfile 及 docker-compose.yml 文件。 

\- 项目说明文档（README.md）





## 项目技术架构

后端：springboot

前端：vue

数据库：mysql，使用docker初始化，database文件夹下有init子文件夹用于存放初始化脚本

项目使用docker初始化，api使用阿里千问模型的api



## 数据库表设计要求

### 1.用户表

```
-- 用户表
CREATE TABLE IF NOT EXISTS user (
  id BIGINT NOT NULL AUTO_INCREMENT COMMENT '用户ID',
  username VARCHAR(50) NOT NULL COMMENT '用户名',
  password VARCHAR(255) NOT NULL COMMENT '密码（BCrypt哈希）',
  nickname VARCHAR(50) NULL COMMENT '昵称',
  email VARCHAR(100) NULL COMMENT '邮箱',
  phone VARCHAR(20) NULL COMMENT '手机号',
  avatar VARCHAR(255) NULL COMMENT '头像URL',
  gender TINYINT(1) NULL COMMENT '性别 0-未知 1-男 2-女',
  birthday DATE NULL COMMENT '生日',
  status TINYINT(1) NOT NULL DEFAULT 1 COMMENT '状态 0-禁用 1-正常',
  last_login_time DATETIME NULL COMMENT '最后登录时间',
  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  is_deleted TINYINT(1) NOT NULL DEFAULT 0 COMMENT '是否删除',
  PRIMARY KEY (id),
  UNIQUE KEY uk_username (username),
  KEY idx_email (email),
  KEY idx_phone (phone)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='用户表';
```



### 2.会话表

```
-- 会话表
CREATE TABLE IF NOT EXISTS chat_session (
  id BIGINT NOT NULL AUTO_INCREMENT COMMENT '会话ID',
  user_id BIGINT NOT NULL COMMENT '所属用户',
  title VARCHAR(100) NULL COMMENT '会话标题',
  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  is_deleted TINYINT(1) NOT NULL DEFAULT 0 COMMENT '是否删除',
  PRIMARY KEY (id),
  KEY idx_user (user_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='聊天会话';
```



### 3.消息表

```
-- 消息表
CREATE TABLE IF NOT EXISTS chat_message (
  id BIGINT NOT NULL AUTO_INCREMENT COMMENT '消息ID',
  session_id BIGINT NOT NULL COMMENT '会话ID',
  role VARCHAR(20) NOT NULL COMMENT '角色 user/assistant/system',
  content TEXT NOT NULL COMMENT '消息内容',
  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '发送时间',
  PRIMARY KEY (id),
  KEY idx_session (session_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='聊天消息';
```



## 接口设计

### 1.统一响应格式

```
// 成功
{
  "code": 0,
  "message": "操作成功",
  "data": { /* 业务数据 */ },
  "timestamp": 1730728800000
}

// 失败
{
  "code": 1,
  "message": "错误信息",
  "data": null,
  "timestamp": 1730728800000
}
```



### 2.用户功能相关接口

```
# 1) 注册
POST /api/user/register
Content-Type: application/json
Body: {
  username: string(3-50),
  password: string(6-64),
  email?: string,
  phone?: string
}
Success: { code: 0, message: "注册成功" }
Errors: 409 用户名已存在 / 400 参数不合法

# 2) 登录
POST /api/user/login
Body: { username: string, password: string }
Success: {
  code: 0,
  data: {
    token: string,            # JWT
    expiresAt: long,          # 过期时间戳
    user: { id, username, nickname, avatar }
  }
}
Errors: 401 用户名或密码错误 / 423 用户被禁用

# 3) 获取当前用户信息
GET /api/user/info
Headers: Authorization: Bearer 
Success: {
  code: 0,
  data: { id, username, nickname, email, phone, avatar, status, lastLoginTime, createdAt }
}
Errors: 401 未授权

# 4) 更新个人资料
PUT /api/user/profile
Headers: Authorization: Bearer 
Body: { nickname?, email?, phone?, avatar? }
Success: { code: 0, data: { ...updatedUser } }
Errors: 400 参数不合法 / 409 邮箱或手机号冲突

# 5) 修改密码
POST /api/user/password/change
Headers: Authorization: Bearer 
Body: { oldPassword: string, newPassword: string(>=6) }
Success: { code: 0, message: "修改成功" }
Errors: 400 新密码不合法 / 401 未授权 / 403 旧密码不正确
```



### 3.会话相关接口

接口都放在/api/chat下

实现创建会话、查询会话列表、删除会话、发送消息、查询当前会话消息



## 后端调用千问模型文档

SDK 调用配置的`base_url`：`https://dashscope.aliyuncs.com/compatible-mode/v1`



以下是官方文档的调用示例：

```java
// 该代码 OpenAI SDK 版本为 2.6.0
import com.openai.client.OpenAIClient;
import com.openai.client.okhttp.OpenAIOkHttpClient;
import com.openai.models.chat.completions.ChatCompletion;
import com.openai.models.chat.completions.ChatCompletionCreateParams;

public class Main {
    public static void main(String[] args) {
        OpenAIClient client = OpenAIOkHttpClient.builder()
                .apiKey(System.getenv("DASHSCOPE_API_KEY"))
                .baseUrl("https://dashscope.aliyuncs.com/compatible-mode/v1")
                .build();

        ChatCompletionCreateParams params = ChatCompletionCreateParams.builder()
                .addUserMessage("你是谁")
                .model("qwen-plus")
                .build();

        try {
            ChatCompletion chatCompletion = client.chat().completions().create(params);
            System.out.println(chatCompletion);
        } catch (Exception e) {
            System.err.println("Error occurred: " + e.getMessage());
            e.printStackTrace();
        }
    }
}
```

以下是官方文档的响应示例：

```json
{
    "choices": [
        {
            "message": {
                "role": "assistant",
                "content": "我是阿里云开发的一款超大规模语言模型，我叫通义千问。"
            },
            "finish_reason": "stop",
            "index": 0,
            "logprobs": null
        }
    ],
    "object": "chat.completion",
    "usage": {
        "prompt_tokens": 3019,
        "completion_tokens": 104,
        "total_tokens": 3123,
        "prompt_tokens_details": {
            "cached_tokens": 2048
        }
    },
    "created": 1735120033,
    "system_fingerprint": null,
    "model": "qwen-plus",
    "id": "chatcmpl-6ada9ed2-7f33-9de2-8bb0-78bd4035025a"
}
```

DASHSCOPE_API_KEY已在作者本地添加永久性环境变量，用户下载代码后需配置自己的阿里大模型key。